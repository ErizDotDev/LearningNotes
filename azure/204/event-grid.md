# ☮️ Azure Event Grid
---

- Azure equivalent of AWS EventBridge.
- A serverless event broker service fully ingrained in Azure and its other services that simplifies the consumption of events by efficiently redirecting events from Azure and non-Azure resources and distributes the events to registered subscriber endpoints.
	- This results in lower costs by removing the need to poll endpoints to get certain responses from services.
	- Useful for applications powered by event-driven architectures and the pub/sub pattern (publisher/subscriber)
		- Publishers can be any Azure services or SaaS applications.

## Concepts in Event Grid

### Events

- What happened in the system.
- Contains generic information such as the event source, the time the event occurred, and an ID as well as information specific to a particular occurrence.
	- Example: A file upload event will give details about the file that was uploaded like its file size, and date last modified.
- Only events with a size of 64KB is covered by SLA.
	- Events exceeding 64KB are charged a fee per additional 64KB.

### Event Source

- Where the event happens.
- Responsible for sending events to the Event Grid.
- Each event source represents the type of events that occurred in it.
	- Azure Storage is the source for blob related events.
	- IoT Hub is the source for device related events.
	- Your application is the source of custom events.

### Topics

- Provides endpoints where event sources send their events.
- Publisher creates a topic and they can create multiple topics.
- To respond to certain types of events, subscribers must choose which topic they should subscribe to.

- Types of topics:
	- **System topics**
		- Azure service specific topics not visible in your subscription.
		- However, subscribers can choose these topics to subscribe to them for specific events.
	- **Custom topics**. Topics that are generated by the application or third party, and are visible in your subscription.

### Event subscriptions

- Tells Event Grid which events in the topic you're interested in receiving.
- Creating a subscription is creating an endpoint that will handle the event.
	- Events can be filtered out through this endpoint by their event type or subject pattern.
- Expiration can be configured for subscriptions.
	- Useful for short lived subscriptions as it will automatically clean up said expired subscription.

### Event handlers

- Where the event is sent.
- Provides additional steps that will further process the event.
- Supports several handler types such as an Azure service or a custom webhook that you created.
	- Depending on the selected handler type, Event Grid will follow the handler's specific process to guarantee the delivery of the event.
		- For webhook, event will be retried until it returns the status code of 200.
		- For Azure Storage Queue, event will be retried until the service successfully pushes the message into the queue.

## Event schemas

- Can be an Event Grid event schema or a Cloud event schema.
	- Can be used interchangeably;
	- Allows back and forth conversion;
- Events have a set of properties that is common on any publisher.
	- The data object contains information specific to a publisher.
		- For system topics, the properties are specific to the Azure resource or service.

- Event sources are sending collections of events to Event Grid as an array.
	- The array should be 1MB at most.
	- If the size of the array exceeds the 1MB limit, they will get a `413 Payload Too Large` response.

### Event Grid schema

- Contains properties like `topic`, `subject`, `eventType`, `id`, `data` and many more.
- Custom topics should contain the standard properties.
	- Their data properties can contain their own custom properties.

- When publishing events to custom topics, create subjects.
	- Subjects are used to filter and distribute events.
	- Subject should have a path value that will represent where the event took place.
		- Paths are effective in narrowing or widening filters that can be used to identify events in a topic.
	- Use subjects like how you filter files in a directory tree.
		- You can also choose to filter out by file extension as it is possible.

### Cloud schema

- Azure natively supports the JSON implementation of CloudEvents, an open specification of how event data is represented across various platforms.
- Provides a uniform and standard way for publishing and consuming cloud based events, which promotes interoperability across different applications in different environments and platforms.

- Headers for both Event Grid schema and Cloud schema are the same except for the `content-type`
	- For Event Grid, it's `application/json`
	- For Cloud schema, it's `application/cloudevents+json`